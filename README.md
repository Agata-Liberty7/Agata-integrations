# Сервис сбора данных "Агата"

## Описание
Данный сервис состоит из двух основных частей: парсера гос. реестров и аггрегатора данных клиентов. Объединяет их общий веб-интерфейс, который позволяет просматривать данные и управлять ими.


### Установка
Для установки необходимо выполнить следующие действия:

1. Склонировать репозиторий
```bash 
git clone
```
2. Установить зависимости
```bash
go get 
cd ./web
npm install
```
3. Указать рабочий регион интерфейса
- В файле `./web/src/main.js` указать значение переменных `region` и `host` в соответствии с регионом, в котором будет работать сервис
- В файле `./main.go` указать значение переменных `HOST` и `DB_HOST` в соответствии c адресом базы данных и адресом веб-интерфейса

4. Собрать интерфейс
```bash
cd ./web
npm run build
```

5. Собрать проект
```bash
go build ./cmd/main.go -o agata
```


### Запуск сервиса

Для запуска сервиса необходимо выполнить следующие действия:

1. Запустить базу данных
```bash
docker-compose up -d
```

2. Запустить веб-интерфейс
```bash
./agata
```

Для запуска в режиме отпладки необходимо добавить флаг `-d`


### Использование
Сервис предоставляет веб-интерфейс, который позволяет управлять данными и просматривать их. Для доступа к интерфейсу необходимо перейти по адресу `http://localhost:8080` (при использовании дефолтных настроек). В верхней части страницы расположены кнопки для перехода между разделами. В левой части страницы расположены кнопки для управления данными. В правой части страницы расположены таблицы с данными.

#### Раздел "Клиенты"
В данном разделе отображаются данные о клиентах. Для добавления нового клиента необходимо нажать кнопку "Добавить клиента". Для редактирования существующего клиента необходимо нажать кнопку "Редактировать" в соответствующей строке таблицы. Для удаления клиента необходимо нажать кнопку "Удалить" в соответствующей строке таблицы.

#### Раздел "Реестры"
На основе выбранного региона интерфейса в данном разделе отображаются данные из реестров разного набора стран. 
В российском регионе доступны данные РФ, Беларуси, Азербайджана и Казахстана.
В глобальном регионе -- данные реестров Казахстана, Азербайджана, Чехии, Германии, США и ЕС.

Выберите показатель для отображения данных, находящихся в системе. Если данных нет, нажмите "Получить из реестра" для загрузки данных из реестра в систему. Также возможно "Сбросить данные" по показателю. Чтобы вручную загрузить данные, скачайте шаблон, заполните его и загрузите его в систему, нажав "Выберите файл".

С програмной точки зрения раздел состоит из общей инфраструктуры и набора парсеров по разным показателям отдельных стран. Полный перечень источников данных можно посмотреть в файле `sources.xlsx`. Сами парсеры находятся в пакете `stats` и объединены общим интерфейсом. 

Данные парсинга укладываются в общую структуру данных, которая описана в файле с шаблоном ручного заполнения. Показатель может как содержать информацию по всем полям, так и только по некоторым из них. 
